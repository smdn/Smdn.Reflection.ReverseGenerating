<Project Sdk="Microsoft.NET.Sdk">
  <Import Project="..\..\..\Common\test\Common.Tests.props" />

  <PropertyGroup>
    <TargetFrameworks>net5.0<!-- ;net472 --></TargetFrameworks>
    <RootNamespace>Smdn.Reflection.ReverseGenerating.ListApi</RootNamespace>
    <TestAssemblyRootDirectory>$(MSBuildThisFileDirectory)..\assm</TestAssemblyRootDirectory>
    <NoWarn>CS2002;$(NoWarn)</NoWarn>
  </PropertyGroup>

  <ItemGroup>
    <ProjectReference Include="..\src\list-api.csproj" />
  </ItemGroup>

  <Target Name="WriteTestAssemblyInfo" BeforeTargets="BeforeBuild">
    <ItemGroup>
      <SourceLines Include="namespace $(RootNamespace)$([MSBuild]::Escape(';'))" />
      <SourceLines Include="public static class TestAssemblyInfo {" />
      <SourceLines Include="public static readonly System.IO.DirectoryInfo RootDirectory = new(@&quot;$(TestAssemblyRootDirectory)&quot;)$([MSBuild]::Escape(';'))" />
      <SourceLines Include="}" />
    </ItemGroup>
    <PropertyGroup>
      <TestAssemblyInfoFilePath>$(MSBuildThisFileDirectory)TestAssemblyInfo.cs</TestAssemblyInfoFilePath>
    </PropertyGroup>
    <WriteLinesToFile
      File="$(TestAssemblyInfoFilePath)"
      Overwrite="true"
      Lines="@(SourceLines)"
    />
    <ItemGroup>
      <!-- XXX: This causes compiler warning CS2002. -->
      <Compile Include="$(TestAssemblyInfoFilePath)" />
    </ItemGroup>
  </Target>
</Project>
